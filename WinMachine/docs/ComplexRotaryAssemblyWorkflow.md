# 复杂旋转装配流程说明 (Complex Rotary Assembly Workflow)

本文档描述了 `ComplexRotaryAssemblyScenario.cs` 中定义的机器运行逻辑。

## 1. 核心组件
机器主要由三个部分组成：
1. **中间滑台 (Middle Slide)**：负责在左右两个模组之间移动物料。滑台上有4个工位（左侧组 `Vac1/2`，右侧组 `Vac3/4`）。
2. **左右装配模组 (Left/Right Assembly Modules)**：每个模组包含一个升降气缸 (`Lift`)、一个旋转轴 (`Rotary Table`) 和两组夹爪 (`Grips`)。模组外侧设有测试座 (`Test Stations`)。
3. **中央上下料机构 (Central Feeder)**：悬挂在中间，负责向滑台上料（新料）和取走成品（旧料）。

## 2. 详细动作流程

整个机器的运行是一个无限循环，主要分为两个相位：**滑台向左** 和 **滑台向右**。

### 相位 1：滑台向左 (Slide Left)
1. **安全互锁检查**：确保所有垂直轴（Feeder升降、左模组升降、右模组升降）都处于**上升状态**，防止撞机。
2. **滑台移动**：中间滑台气缸伸出，将滑台推向左侧。
3. **并行任务执行**：
    *   **左模组 (Left Module)** 执行装配/测试任务。
    *   **右侧工位组 (Feeder Right Group)** 执行上下料任务（此时右侧工位位于中央 Feeder 下方）。

### 相位 2：滑台向右 (Slide Right)
1. **安全互锁检查**：再次确保所有垂直轴处于**上升状态**。
2. **滑台移动**：中间滑台气缸缩回，将滑台推向右侧。
3. **并行任务执行**：
    *   **右模组 (Right Module)** 执行装配/测试任务。
    *   **左侧工位组 (Feeder Left Group)** 执行上下料任务（此时左侧工位位于中央 Feeder 下方）。

---

## 3. 子任务逻辑详解

### A. 上下料逻辑 (Feeder Job)
此逻辑用于 Feeder 对位于其下方的工位（VacInner, VacOuter）进行操作：
1. **准备**：Feeder 移动到位（逻辑上）。
2. **下降**：Feeder 升降气缸下降。
3. **物料处理**：
    *   **上料**：如果工位是空的 (`Empty`)，模拟生成一个新物料 (`New`)。
    *   **下料**：如果工位上有旧物料 (`Old`)，模拟将其消耗掉 (`Consume`)。
4. **上升**：Feeder 升降气缸上升，完成操作。

### B. 装配与测试逻辑 (Assembly Job)
此逻辑用于左右模组进行物料交换和测试。只有当“滑台上有新料”或者“测试座上有成品”时才会触发动：
1. **条件检查**：检查滑台工位 (`VacSlide`) 和测试工位 (`VacTest`) 的物料状态。
2. **取料 (Pick)**：
    *   升降轴确保在上方，夹爪打开。
    *   升降轴下降。
    *   夹爪闭合（同时抓住滑台上的新料和测试座上的旧料）。
3. **绑定 (Bind)**：逻辑上将物料绑定到夹爪（临时状态）。
4. **交换 (Swap)**：
    *   升降轴上升。
    *   旋转台旋转 180 度（交换新旧料位置）。
5. **放料 (Place)**：
    *   升降轴下降。
    *   夹爪打开。
    *   **物料转移**：新料被放置到测试座，旧料/成品被放置回滑台。
6. **测试 (Test)**：
    *   模拟 5秒 的测试过程。
    *   测试完成后，将测试座上的物料状态更新为 `Tested`。
7. **复位**：升降轴上升，准备下一次循环。

## 4. 信号定义
*   **气缸状态**：
    *   `Lift` (升降): `True` = 上升 (Up), `False` = 下降 (Down)。
    *   `Grip` (夹爪): `True` = 打开 (Open), `False` = 闭合 (Close)。
    *   `Slide` (滑台): `True` = 左侧 (Left), `False` = 右侧 (Right)。
*   **物料状态**：
    *   `New`: 新料，待测试。
    *   `Tested`: 已测试，良品。
    *   `Old`: 已处理完毕，待下料。
